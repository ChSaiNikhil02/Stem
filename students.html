<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaderboard</title>
    <link rel="stylesheet" href="css/leaderboard-updated.css">
    <link rel="stylesheet" href="css/teacher-dashboard.css">
</head>
<body>
    <header class="dashboard-header">
        <div class="header-left">
            <div class="logo">STEM Exploer</div>
            <nav class="main-nav">
                <a href="teacher_dashboard.html">Dashboard</a>
            </nav>
        </div>
        <div class="header-right">
            <button class="logout-btn" id="logout-button">Logout</button>
        </div>
    </header>

    <main class="dashboard-main">
        <div class="leaderboard-container">
            <h1>Top Students</h1>
            <div class="filters">
                <select id="class-filter" class="filter-dropdown">
                    <option value="">All Classes</option>
                    <option value="1">Class I</option>
                    <option value="2">Class II</option>
                    <option value="3">Class III</option>
                    <option value="4">Class IV</option>
                    <option value="5">Class V</option>
                    <option value="6">Class VI</option>
                    <option value="7">Class VII</option>
                    <option value="8">Class VIII</option>
                    <option value="9">Class IX</option>
                    <option value="10">Class X</option>
                    <option value="11">Class XI</option>
                    <option value="12">Class XII</option>
                </select>
                <input type="text" id="search-input" placeholder="Search students..." class="search-input">
            </div>
            <table id="leaderboard-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Name</th>
                        <th>Class</th>
                        <th>Score</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be populated here by JavaScript -->
                </tbody>
            </table>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let allStudents = [];
            const tableBody = document.querySelector('#leaderboard-table tbody');
            const searchInput = document.getElementById('search-input');
            const classFilter = document.getElementById('class-filter');

            function renderTable(students) {
                tableBody.innerHTML = ''; // Clear existing rows
                students.forEach((student, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${student.fullname}</td>
                        <td>${student.class}</td>
                        <td>${student.totalScore.toFixed(2)}</td>
                    `;
                    tableBody.appendChild(row);
                });
            }

            function applyFilters() {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedClass = classFilter.value;

                let filteredStudents = allStudents;

                if (selectedClass) {
                    filteredStudents = filteredStudents.filter(student => student.class === selectedClass);
                }

                if (searchTerm) {
                    filteredStudents = filteredStudents.filter(student =>
                        student.fullname.toLowerCase().includes(searchTerm) ||
                        student.class.toLowerCase().includes(searchTerm)
                    );
                }

                renderTable(filteredStudents);
            }

            fetch('/api/leaderboard')
                .then(response => response.json())
                .then(data => {
                    allStudents = data;
                    renderTable(allStudents);
                })
                .catch(error => {
                    console.error('Error fetching leaderboard data:', error);
                });

            searchInput.addEventListener('input', applyFilters);
            classFilter.addEventListener('change', applyFilters);
        });

        document.getElementById('logout-button').addEventListener('click', () => {
            fetch('/logout', { method: 'POST' })
                .then(response => {
                    if (response.ok) {
                        window.location.href = '/login.html';
                    } else {
                        alert('Logout failed.');
                    }
                })
                .catch(error => {
                    console.error('Error during logout:', error);
                });
        });
    </script>
</body>
</html>